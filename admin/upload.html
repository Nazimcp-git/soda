<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  background: #f8f9fb;
  margin: 0;
  padding: 20px;
  color: #111;
}

h1 {
  margin-bottom: 20px;
  text-align: center;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 15px;
}

.card {
  background: #fff;
  border: 1px solid #e0e0e0;
  padding: 10px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
}

.card .title {
  font-weight: bold;
  margin: 8px 0 4px;
}

.card .price {
  font-size: 16px;
  font-weight: 700;
  color: #333;
}

/* Admin page */
form {
  background: #fff;
  padding: 20px;
  border: 1px solid #e0e0e0;
  margin-bottom: 20px;
}

input, button {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
}

button {
  background: #111827;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #000;
}

.list {
  background: #fff;
  border: 1px solid #ddd;
  padding: 10px;
}

.item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #eee;
}

.item img {
  width: 60px;
  height: 40px;
  object-fit: cover;
  margin-right: 10px;
}

.actions button {
  margin-left: 5px;
  background: #444;
}

  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script>
    // firebase-config.js
var firebaseConfig = {
  apiKey: "AIzaSyBYCiz_Ec0GeQajAKP3RrxylR1bjIr9wnQ",
                authDomain: "nishan-8d4db.firebaseapp.com",
                databaseURL: "https://nishan-8d4db-default-rtdb.firebaseio.com",
                projectId: "nishan-8d4db",
                storageBucket: "nishan-8d4db.appspot.com",
                messagingSenderId: "856716933837",
                appId: "1:856716933837:web:b6114e617a0c001d3f8784",
                measurementId: "G-ZB1X291PJY"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();

  </script>
</head>
<body>
  <h1>Admin Panel</h1>

  <form id="productForm">
    <input type="hidden" id="editId">
    <input type="text" id="title" placeholder="Product Title" required>
    <input type="number" id="price" placeholder="Price" required>
    <input type="file" id="image" accept="image/*">
    <button type="submit">Save Product</button>
  </form>

  <div class="list" id="productList"></div>

  <script>
    const form = document.getElementById('productForm');
    const list = document.getElementById('productList');
    const editId = document.getElementById('editId');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const price = document.getElementById('price').value;
      const file = document.getElementById('image').files[0];

      if (!title || !price) return alert('Please fill all fields.');

      let id = editId.value || db.ref('products').push().key;
      let imageUrl = '';
      let imagePath = '';

      if (file) {
        const path = `products/${id}/${file.name}`;
        const upload = await storage.ref(path).put(file);
        imageUrl = await upload.ref.getDownloadURL();
        imagePath = path;
      }

      const product = { title, price, imageUrl, imagePath };

      if (editId.value) {
        await db.ref('products/' + id).update(product);
        alert('Product updated!');
      } else {
        await db.ref('products/' + id).set(product);
        alert('Product added!');
      }

      form.reset();
      editId.value = '';
    });

    db.ref('products').on('value', snapshot => {
      list.innerHTML = '';
      const data = snapshot.val();
      if (data) {
        Object.keys(data).forEach(id => {
          const p = data[id];
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <div style=\"display:flex;align-items:center;\">
              <img src=\"${p.imageUrl}\" alt=\"${p.title}\">
              <div>
                <div><b>${p.title}</b></div>
                <div>â‚¹${p.price}</div>
              </div>
            </div>
            <div class=\"actions\">
              <button onclick=\"editProduct('${id}')\">Edit</button>
              <button onclick=\"deleteProduct('${id}', '${p.imagePath}')\">Delete</button>
            </div>
          `;
          list.appendChild(div);
        });
      } else {
        list.innerHTML = '<p>No products yet.</p>';
      }
    });

    window.editProduct = function(id) {
      db.ref('products/' + id).once('value').then(snap => {
        const p = snap.val();
        document.getElementById('title').value = p.title;
        document.getElementById('price').value = p.price;
        editId.value = id;
      });
    };

    window.deleteProduct = async function(id, path) {
      if (!confirm('Delete this product?')) return;
      await db.ref('products/' + id).remove();
      if (path) await storage.ref(path).delete().catch(() => {});
      alert('Product deleted');
    };
  </script>
</body>
</html>
